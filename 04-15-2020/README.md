# Today I Learned

## Database

Today at the GoStack Bootcamp, we started learning about databases. We'll be using
[Postgres](https://www.postgresql.org/) on the GoBarber application.

There three ways, which we can use to work with databases on the back-end:

- Drivers: it's the most basic. You need to manually write all the queries you'll
be needing on your application.
- QueryBuilder: it's a mid-level abstraction. Instead of writing your own queries,
you have access to a lot of methods, that you can combine to perform a query on the
database. The QueryBuilder is responsible for build the query, based on the methods
you used.
- ORM (Object Relational Mapping): it's a high-level abstraction. Here, you'll only
tell the ORM what are your models, and everytime you create a new instance of it,
it'll be saved to the database. You don't need to worry about queries at all. The
ORM will take care of everything.
  - As the name suggests, the ORM will be mapping the (in this case) JavaScript/Typescript
objects to the relations on the SQL database.
  - Examples: TypeORM and Sequelize (for TypeScript and JavaScript respectively)

The advanteges of using a QueryBuilder/ORM is that you won't be dependent on the type of
database. If the database change, you'll need to change only the drivers, and everything
else stays the same.

It's ideal to combine the QueryBuilder with the ORM. The ORM will be used to the basics
and any type of complex database consult, can be achieved with the Query Builder.

## Docker

To make it easier to configure the enviroment, will be using Docker to install our
Postgres database.

Docker makes it easy to prepare/migrate applications, isolating them and just exposing
the port for external communication.

You need only to download an image, choose the port e transfer the application files,
and you're good to go!

## Database Management

[DBeaver](https://dbeaver.io/) is the software chosen to access the Postgres database.
It's an agnostic database manager and works with any of the most popular databases out there.

## Migrations

We also learned about the concept of Migrations. To put it simply: it is a way to version
control the database among a team of developers.

Any developer can create/alter/remove things from the database. To make it easier and automate
the task of applying theses changes, developers can make use of the migrations.

You write a migration with Up & Down methods. The Up method introduces changes to the database,
and the Down methods revert those changes. After that, you need only to run the migrations and
the database will be ready.

To alter a migration, you can create a new migration (assuming that the old migration is already
on the teams git) and, in this case, there are no rules, or you can revert the old migration
(if the migration is only local), alter the migration file and run it again.

## Decorator

To make simpler to use the TypeORM, we'll be using the Decorator Pattern. I'm not too sure
about how it actually works - since I never used it before -, but you need to make it available
on TypeScript by changing the config file (also you need to alter the 'strictPropertyInitialization'
to 'false').

It'll work by adding a @ at the top of a class or attribute, and will make that class/attribute
as a parameter to the builders of the TypeORM. We need to use this on the models files, and on the
repository files. An example can be found here:

- Model: https://github.com/bernas1104/gostack/blob/master/semana-ii/iniciando-back-end-app/src/models/Appointment.ts
- Repository: https://github.com/bernas1104/gostack/blob/master/semana-ii/iniciando-back-end-app/src/repositories/AppointmentsRepository.ts

To access the repositories, you need to import the 'getCustomRepository' function of the TypeORM.

### Observations

When creating the models, any type of data that will be generated by the ORM needs the function that
will be generating it. On the GoBarber application, the Appointment ID is a UUID, so you need to pass the
function "uuid_generate_v4()" as the default value to the ID column.